<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <title>week 4 - assignment 2</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html {
        font-size: 62.5%;
      }
      body {
        color: #333;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(
          to bottom right,
          rgba(204, 221, 238, 0.7),
          rgba(76, 138, 199, 1)
        );

        display: flex;
        justify-content: center;
        align-items: center;
      }

      button {
        /* init */
        border: none;
        background-color: transparent;

        font-size: 4rem;
        font-family: "Lato";

        padding: 2.5rem 7.5rem;
        border-radius: 5px;
        /* background-color: rgb(29, 82, 134, 0.2); */
        background-color: rgb(255, 255, 255, 0.2);
        box-shadow: 0 1.2rem 2.4rem rgba(0, 0, 0, 0.2);

        transform: translateY(0);
        transition: all 0.3s;
      }

      button:hover {
        background-color: rgb(29, 82, 134, 0.7);
        box-shadow: 0 1.8rem 3rem rgba(0, 0, 0, 0.1);
        transform: translateY(-0.5rem);
      }

      button:active {
        background-color: rgb(29, 82, 134, 1);
        box-shadow: 0 0.8rem 1.6rem rgba(0, 0, 0, 0.35);
        transform: translateY(1.5rem);
      }
      .container {
        width: 30%;
        height: 85%;
        max-width: 30rem;
        max-height: 50rem;
        background-color: #fff;

        padding: 1rem;
        border-radius: 9px;
        box-shadow: 0 1.2rem 2.4rem rgba(0, 0, 0, 0.2);

        display: flex;
        flex-direction: column;

        transform: translateY(1rem);
        visibility: hidden;
        opacity: 0;
        transition: all 0.3s ease-out;
      }

      .container:not(:last-child) {
        margin-right: 3rem;
      }

      .container-show {
        transform: translateY(0rem);
        visibility: visible;
        opacity: 1;
      }

      .img-container {
        height: 40%;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        overflow: hidden;

        background-position: center;
        background-repeat: no-repeat;
        background-size: 80%;

        position: relative;
      }
      .product-container {
        height: 60%;
        padding: 2.4rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .product-container span {
        font-size: 1.6rem;
        font-family: "Lato";
      }

      .product-container span:not(:last-child) {
        margin-bottom: 2rem;
      }
      #product-info-0 {
        font-size: 2.2rem;
      }
      #product-info-1 {
        font-size: 3rem;
        color: darkcyan;
      }
      #product-info-2 {
        color: #777;
      }
    </style>
  </head>
  <body>
    <button type="click" id="click">SHOW PRODUCTS</button>
    <script>
      const body = document.body;
      const button = document.querySelector("#click");
      const imageArr = ["./img/1.webp", "./img/2.webp", "./img/3.webp"];

      function createNewHTMLElememt(elementTag, elementText) {
        let inputText = "";
        if (elementText !== null) inputText = elementText;
        const newElement = document.createElement(elementTag);
        const text = document.createTextNode(inputText);
        newElement.appendChild(text);
        return newElement;
      }

      function createAttribute(element, attributeArr) {
        attributeArr.forEach((attribute) => {
          element.setAttribute(attribute.attribute, attribute.value);
        });
      }

      /* helper for AJAX */
      async function getProducts(url) {
        try {
          // 1)get res from server
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Unable to connect to this " + url);
          }
          // 2)parse res from json to js object
          const data = await response.json();
          if (data.length === 0) {
            throw new Error("There is no data");
          }
          // 3) return data
          return data;
        } catch (err) {
          const errorMessage = createNewHTMLElememt("div", err.message);
          body.appendChild(errorMessage);
        }
      }

      async function render() {
        /* call helper to get returned data */
        const products = await getProducts(
          "https://appworks-school.github.io/Remote-Aassigiment-Data/products"
        );

        // hide button after being clicked
        button.style.visibility = "hidden";
        button.style.opacity = "0";

        setTimeout(() => {
          // make button undisplayed on screen
          button.style.display = "none";
          // render product cards
          products.forEach((product, index) => {
            // 1)create containers
            const container = createNewHTMLElememt("div", null);
            const imgContainer = createNewHTMLElememt("div", null);
            const productInfoContainer = createNewHTMLElememt("div", null);

            // 2)give container class
            container.classList.add("container");
            imgContainer.classList.add("img-container");
            productInfoContainer.classList.add("product-container");

            // 3)create images
            createAttribute(imgContainer, [
              { attribute: "role", value: "img" },
              { attribute: "aria-label", value: product.description },
            ]);
            imgContainer.style.backgroundImage = `url(${imageArr[index]})`;

            // 4)create text box
            const productTitle = createNewHTMLElememt("span", `${product.name}`);
            const productPrice = createNewHTMLElememt("span", `${product.price}`);
            const productDescription = createNewHTMLElememt("span", `${product.description}`);
            [productTitle, productPrice, productDescription].forEach((text, index) => {
              text.setAttribute("id", `product-info-${index}`);
              productInfoContainer.appendChild(text);
            });

            // 5)fill container
            container.appendChild(imgContainer);
            container.appendChild(productInfoContainer);
            body.appendChild(container);

            setTimeout(() => {
              container.classList.add("container-show");
            }, 300);
          });
        }, 300);
      }

      button.addEventListener("click", render);
    </script>
  </body>
</html>
